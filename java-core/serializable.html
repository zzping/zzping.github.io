<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java 序列化 | 南风知我意</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/images/nf.png">
    <meta name="description" content="后端开发 南风知我意的个人网站">
    
    <link rel="preload" href="/assets/css/0.styles.d2a44814.css" as="style"><link rel="preload" href="/assets/js/app.fa9b922e.js" as="script"><link rel="preload" href="/assets/js/2.25cc5d58.js" as="script"><link rel="preload" href="/assets/js/32.173e5f2d.js" as="script"><link rel="prefetch" href="/assets/js/10.a87e3e41.js"><link rel="prefetch" href="/assets/js/11.0364ff90.js"><link rel="prefetch" href="/assets/js/12.311eca75.js"><link rel="prefetch" href="/assets/js/13.0157e368.js"><link rel="prefetch" href="/assets/js/14.12ac4ad9.js"><link rel="prefetch" href="/assets/js/15.356aa848.js"><link rel="prefetch" href="/assets/js/16.bc1151d9.js"><link rel="prefetch" href="/assets/js/17.def4874d.js"><link rel="prefetch" href="/assets/js/18.e350c724.js"><link rel="prefetch" href="/assets/js/19.e83e1d7c.js"><link rel="prefetch" href="/assets/js/20.c97de166.js"><link rel="prefetch" href="/assets/js/21.d2f7bd5c.js"><link rel="prefetch" href="/assets/js/22.41adaee0.js"><link rel="prefetch" href="/assets/js/23.799354b2.js"><link rel="prefetch" href="/assets/js/24.95fca6d6.js"><link rel="prefetch" href="/assets/js/25.465e8b94.js"><link rel="prefetch" href="/assets/js/26.16f7559c.js"><link rel="prefetch" href="/assets/js/27.ff4ffb1f.js"><link rel="prefetch" href="/assets/js/28.044518d6.js"><link rel="prefetch" href="/assets/js/29.dd693b24.js"><link rel="prefetch" href="/assets/js/3.ac93ca0a.js"><link rel="prefetch" href="/assets/js/30.962c7f0b.js"><link rel="prefetch" href="/assets/js/31.ed040a46.js"><link rel="prefetch" href="/assets/js/33.02ea8a18.js"><link rel="prefetch" href="/assets/js/34.bb262992.js"><link rel="prefetch" href="/assets/js/35.896e9f41.js"><link rel="prefetch" href="/assets/js/36.1ddb7248.js"><link rel="prefetch" href="/assets/js/37.334aca7d.js"><link rel="prefetch" href="/assets/js/38.c0b524c3.js"><link rel="prefetch" href="/assets/js/39.1fa89074.js"><link rel="prefetch" href="/assets/js/4.ffc5bef0.js"><link rel="prefetch" href="/assets/js/40.d6313086.js"><link rel="prefetch" href="/assets/js/41.3f1e2bbd.js"><link rel="prefetch" href="/assets/js/42.29fd018f.js"><link rel="prefetch" href="/assets/js/43.3f4c39b8.js"><link rel="prefetch" href="/assets/js/44.7ecbe764.js"><link rel="prefetch" href="/assets/js/45.bec8ffa7.js"><link rel="prefetch" href="/assets/js/46.4d6373ca.js"><link rel="prefetch" href="/assets/js/47.a2c38019.js"><link rel="prefetch" href="/assets/js/48.36ff8bd5.js"><link rel="prefetch" href="/assets/js/49.d7349f0b.js"><link rel="prefetch" href="/assets/js/5.48532fea.js"><link rel="prefetch" href="/assets/js/50.3da1f291.js"><link rel="prefetch" href="/assets/js/51.45ef4844.js"><link rel="prefetch" href="/assets/js/52.8986512b.js"><link rel="prefetch" href="/assets/js/53.749813e1.js"><link rel="prefetch" href="/assets/js/54.96f2a134.js"><link rel="prefetch" href="/assets/js/55.4879e422.js"><link rel="prefetch" href="/assets/js/56.e8428beb.js"><link rel="prefetch" href="/assets/js/57.ca777ff0.js"><link rel="prefetch" href="/assets/js/58.dbb557db.js"><link rel="prefetch" href="/assets/js/59.df72912c.js"><link rel="prefetch" href="/assets/js/6.5eff19f1.js"><link rel="prefetch" href="/assets/js/60.d1ef93aa.js"><link rel="prefetch" href="/assets/js/61.b14ca761.js"><link rel="prefetch" href="/assets/js/62.2b179e3c.js"><link rel="prefetch" href="/assets/js/63.2f9c3889.js"><link rel="prefetch" href="/assets/js/64.9aa6d939.js"><link rel="prefetch" href="/assets/js/65.566da386.js"><link rel="prefetch" href="/assets/js/66.ce6ae55d.js"><link rel="prefetch" href="/assets/js/67.ba64f924.js"><link rel="prefetch" href="/assets/js/68.bfc2523e.js"><link rel="prefetch" href="/assets/js/69.1df26faa.js"><link rel="prefetch" href="/assets/js/7.100b5646.js"><link rel="prefetch" href="/assets/js/70.2063729c.js"><link rel="prefetch" href="/assets/js/71.ec1b8104.js"><link rel="prefetch" href="/assets/js/72.324f3a5e.js"><link rel="prefetch" href="/assets/js/73.17c953d3.js"><link rel="prefetch" href="/assets/js/74.0445d80d.js"><link rel="prefetch" href="/assets/js/75.d323dbb7.js"><link rel="prefetch" href="/assets/js/76.01731c02.js"><link rel="prefetch" href="/assets/js/77.040d470d.js"><link rel="prefetch" href="/assets/js/78.33374f69.js"><link rel="prefetch" href="/assets/js/79.5b3d3b01.js"><link rel="prefetch" href="/assets/js/8.298793bd.js"><link rel="prefetch" href="/assets/js/80.3d4ad376.js"><link rel="prefetch" href="/assets/js/81.7fa4543b.js"><link rel="prefetch" href="/assets/js/82.31832c90.js"><link rel="prefetch" href="/assets/js/83.291a632f.js"><link rel="prefetch" href="/assets/js/84.3efd8628.js"><link rel="prefetch" href="/assets/js/85.27beb273.js"><link rel="prefetch" href="/assets/js/86.d5228a1d.js"><link rel="prefetch" href="/assets/js/87.cad2873f.js"><link rel="prefetch" href="/assets/js/88.76fdf951.js"><link rel="prefetch" href="/assets/js/89.a9d71c3d.js"><link rel="prefetch" href="/assets/js/9.04671bc7.js"><link rel="prefetch" href="/assets/js/90.da55c751.js"><link rel="prefetch" href="/assets/js/91.0b29096c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d2a44814.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">南风知我意</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/java-core/exception.html" class="nav-link">
  Java核心基础
</a></div><div class="nav-item"><a href="/jvm/structure.html" class="nav-link">
  JVM学习
</a></div><div class="nav-item"><a href="/mybatis/mybatis-overview.html" class="nav-link">
  Mybatis
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring全家桶" class="dropdown-title"><span class="title">Spring全家桶</span> <span class="arrow down"></span></button> <button type="button" aria-label="Spring全家桶" class="mobile-dropdown-title"><span class="title">Spring全家桶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/spring-all/spring-framework/ioc-interface.html" class="nav-link">
  Spring Framework
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="拥抱云原生" class="dropdown-title"><span class="title">拥抱云原生</span> <span class="arrow down"></span></button> <button type="button" aria-label="拥抱云原生" class="mobile-dropdown-title"><span class="title">拥抱云原生</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cloud-native/cloud-native-concepts/" class="nav-link">
  云原生概念
</a></li><li class="dropdown-item"><!----> <a href="/cloud-native/docker/docker-overview/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/cloud-native/kubernetes/" class="nav-link">
  Kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/cloud-native/devops/" class="nav-link">
  DevOps
</a></li></ul></div></div><div class="nav-item"><a href="/frontend/vue/vue-overview.html" class="nav-link">
  前端 - Vue
</a></div><div class="nav-item"><a href="/other/java8/why-java8.html" class="nav-link">
  零散知识
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/java-core/exception.html" class="nav-link">
  Java核心基础
</a></div><div class="nav-item"><a href="/jvm/structure.html" class="nav-link">
  JVM学习
</a></div><div class="nav-item"><a href="/mybatis/mybatis-overview.html" class="nav-link">
  Mybatis
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring全家桶" class="dropdown-title"><span class="title">Spring全家桶</span> <span class="arrow down"></span></button> <button type="button" aria-label="Spring全家桶" class="mobile-dropdown-title"><span class="title">Spring全家桶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/spring-all/spring-framework/ioc-interface.html" class="nav-link">
  Spring Framework
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="拥抱云原生" class="dropdown-title"><span class="title">拥抱云原生</span> <span class="arrow down"></span></button> <button type="button" aria-label="拥抱云原生" class="mobile-dropdown-title"><span class="title">拥抱云原生</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cloud-native/cloud-native-concepts/" class="nav-link">
  云原生概念
</a></li><li class="dropdown-item"><!----> <a href="/cloud-native/docker/docker-overview/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/cloud-native/kubernetes/" class="nav-link">
  Kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/cloud-native/devops/" class="nav-link">
  DevOps
</a></li></ul></div></div><div class="nav-item"><a href="/frontend/vue/vue-overview.html" class="nav-link">
  前端 - Vue
</a></div><div class="nav-item"><a href="/other/java8/why-java8.html" class="nav-link">
  零散知识
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java 核心基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-core/exception.html" class="sidebar-link">Java 异常体系</a></li><li><a href="/java-core/reflection.html" class="sidebar-link">Java 反射</a></li><li><a href="/java-core/annotation.html" class="sidebar-link">Java 注解</a></li><li><a href="/java-core/dynamic-proxy.html" class="sidebar-link">Java 动态代理</a></li><li><a href="/java-core/serializable.html" aria-current="page" class="active sidebar-link">Java 序列化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-core/serializable.html#序列化概述" class="sidebar-link">序列化概述</a></li><li class="sidebar-sub-header"><a href="/java-core/serializable.html#java-中的序列化" class="sidebar-link">Java 中的序列化</a></li><li class="sidebar-sub-header"><a href="/java-core/serializable.html#json-序列化" class="sidebar-link">JSON 序列化</a></li><li class="sidebar-sub-header"><a href="/java-core/serializable.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/java-core/generic.html" class="sidebar-link">Java 泛型</a></li><li><a href="/java-core/type.html" class="sidebar-link">Java 类型（Type）</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="java-序列化"><a href="#java-序列化" class="header-anchor">#</a> Java 序列化</h1> <h2 id="序列化概述"><a href="#序列化概述" class="header-anchor">#</a> 序列化概述</h2> <h3 id="_1-什么是序列化和反序列化"><a href="#_1-什么是序列化和反序列化" class="header-anchor">#</a> （1）什么是序列化和反序列化</h3> <p>序列化和反序列化是一个通用的概念，不止 Java 中才有。</p> <p>Java 中的序列化和反序列化的概念：</p> <blockquote><p>序列化： 把<code>对象</code>转换为<code>字节序列</code>的过程称为对象的序列化。</p> <p>反序列化： 把<code>字节序列</code>还原为<code>对象</code>的过程称为对象的反序列化。</p></blockquote> <h3 id="_2-序列化的作用"><a href="#_2-序列化的作用" class="header-anchor">#</a> （2）序列化的作用</h3> <blockquote><ul><li>持久存储</li> <li>网络传输</li></ul></blockquote> <h3 id="_3-业界主流的-5-种序列化技术"><a href="#_3-业界主流的-5-种序列化技术" class="header-anchor">#</a> （3）业界主流的 5 种序列化技术</h3> <blockquote><ul><li>Java 序列化</li> <li>JSON</li> <li>Protocol Buffer</li> <li>Thrift</li> <li>Avro</li></ul></blockquote> <h2 id="java-中的序列化"><a href="#java-中的序列化" class="header-anchor">#</a> Java 中的序列化</h2> <p>Java 语言内置了序列化实现，它提供了一种序列化机制，这种机制能够将一个对象序列化为二进制形式（字节数组），用于写入磁盘或输出到网络，同时也能从网络或磁盘读取字节数组，反序列化成对象，在程序中使用。</p> <blockquote><p>Java 中实现序列化的两种方式： Serializable 接口、Externalizable 接口</p></blockquote> <h3 id="_1-java-中序列化相关的-api"><a href="#_1-java-中序列化相关的-api" class="header-anchor">#</a> （1）Java 中序列化相关的 API</h3> <blockquote><p>Java 中和序列化相关的接口和类都在 java.io 包下，主要涉及到如下类：</p> <p><code>Serializable</code>： 接口，一个对象想要被序列化，那么它的类就要实现 此接口，这个对象的所有属性（包括private属性、包括其引用的对象）都可以被序列化和反序列化来保存、传递。</p> <p><code>Externalizable</code>： 接口， 它继承了 Serializable 接口，有时我们不希望序列化那么多，可以使用这个接口，这个接口的 <strong>writeExternal()</strong> 和 <strong>readExternal()</strong> 方法可以指定序列化哪些属性。</p> <p><code>ObjectOutputStream</code>： JDK 提供的输出流，提供了将对象序列化并将其写入流的方法。</p> <p><code>ObjectInputStream</code>： JDK 提供的输入流，用于读取流并反序列化对象。</p> <hr> <p>Externalizable 这种方式可以指定序列化哪些属性，有时候我们可能只是需要除了某一个属性之外其他属性都需要序列化，使用 Externalizable 的话就需要将需要序列化的属性都写在 writeExternal() 方法中，比较麻烦，这时候我们可以使用 Serializable 接口，并且将不需要序列化的那一个属性加上 <code>transient</code>关键字即可。</p></blockquote> <h3 id="_2-java-序列化方式-1-实现-serializable-接口"><a href="#_2-java-序列化方式-1-实现-serializable-接口" class="header-anchor">#</a> （2）Java 序列化方式 1 - 实现 Serializable 接口</h3> <blockquote><p>1、自定义类 Student，实现序列化接口 Serializable</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@Setter</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

   <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
   <span class="token comment">// 不希望进行序列化和反序列化的字段可以使用 transient 关键字修饰</span>
   <span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>2、使用 ObjectOutputStream 的 writeObject 方法完成序列化</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 序列化对象到文件</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
   <span class="token class-name">Student</span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;zzp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;zzp@demo.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;d:/test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">String</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss,sss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token string">&quot;序列化的日期是: &quot;</span><span class="token operator">+</span> date<span class="token punctuation">)</span><span class="token punctuation">;</span>
   oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
   oos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>3、使用 ObjectInputStream  的 readObject 方法完成反序列化</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 从文件中反序列化还原为对象</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
   <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;d:/test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">String</span> string <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">Student</span> student <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Student</span><span class="token punctuation">)</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></blockquote> <h3 id="_3-java-序列化方式-2-实现-externalizable-接口"><a href="#_3-java-序列化方式-2-实现-externalizable-接口" class="header-anchor">#</a> （3）Java 序列化方式 2 - 实现 Externalizable 接口</h3> <blockquote><p>1、自定义类 Student，实现序列化接口 Externalizable，重写 writeExternal()、readExternal() 两个方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@Setter</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Teacher</span> <span class="token keyword">implements</span> <span class="token class-name">Externalizable</span> <span class="token punctuation">{</span>

   <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>

   <span class="token comment">// 指定序列化时写入的属性</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeExternal</span><span class="token punctuation">(</span><span class="token class-name">ObjectOutput</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
       out<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
       out<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
       out<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// 指定反序列化时读取属性的顺序和属性的值</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readExternal</span><span class="token punctuation">(</span><span class="token class-name">ObjectInput</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
       id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> in<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       username <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> in<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       email <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> in<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>2、使用 ObjectOutputStream 的 writeObject 方法完成序列化</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 序列化对象到文件</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test03</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
   <span class="token class-name">Teacher</span> teacher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Teacher</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;zzp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;zzp@demo.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;d:/test2.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">String</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss,sss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token string">&quot;序列化的日期是: &quot;</span><span class="token operator">+</span> date<span class="token punctuation">)</span><span class="token punctuation">;</span>
   oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>teacher<span class="token punctuation">)</span><span class="token punctuation">;</span>
   oos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>3、使用 ObjectInputStream  的 readObject 方法完成反序列化</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 从文件中反序列化还原为对象</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test04</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
   <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;d:/test2.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">String</span> string <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">Teacher</span> teacher <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Teacher</span><span class="token punctuation">)</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>teacher<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></blockquote> <h3 id="_4-serialversionuid-有什么用"><a href="#_4-serialversionuid-有什么用" class="header-anchor">#</a> （4）serialVersionUID 有什么用？</h3> <blockquote><p>Serializable 接口的文档说明中对 serialVersionUID 描述如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>If a serializable class does not explicitly declare a serialVersionUID, then
the serialization runtime will calculate a default serialVersionUID value
for that class based on various aspects of the class, as described in the
Java(TM) Object Serialization Specification.  However, it is &lt;em&gt;strongly
recommended&lt;/em&gt; that all serializable classes explicitly declare
serialVersionUID values, since the default serialVersionUID computation is
highly sensitive to class details that may vary depending on compiler
implementations, and can thus result in unexpected
&lt;code&gt;InvalidClassException&lt;/code&gt;s during deserialization.  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>如果用户没有自己声明一个serialVersionUID，接口会默认生成一个serialVersionUID。但是强烈建议用户自定义一个serialVersionUID，因为默认的 serialVersinUID 对于 class 的细节非常敏感，反序列化时可能会导致InvalidClassException 这个异常。</p></blockquote> <h3 id="_5-transient-关键字有什么用"><a href="#_5-transient-关键字有什么用" class="header-anchor">#</a> （5）transient 关键字有什么用？</h3> <blockquote><p>transient 是短暂的意思，transient 是 Java 语言的关键字，用来表示一个成员变量不是该对象序列化的一部分。当一个对象被序列化的时候，被 transient 修饰的成员变量的值不包括在序列化的结果中。而非 transient修饰的成员变量是被包括进去的。  <code>注意 static 修饰的静态变量天然就是不可序列化的。</code></p> <hr> <p>为什么要用 transient 关键字？</p> <p>答： 在持久化对象时，对于一些特殊的数据成员（如用户的密码，银行卡号等），我们不想用序列化机制来保存它。为了在一个特定对象的一个成员变量上关闭序列化，可以在这个成员变量前加上关键字 transient。</p> <hr> <p>transient 关键字只能修饰变量，而不能修饰方法和类。</p></blockquote> <h3 id="_6-哪些字段不能被序列化"><a href="#_6-哪些字段不能被序列化" class="header-anchor">#</a> （6）哪些字段不能被序列化</h3> <blockquote><p>（1）<code>被 static 修饰</code>的字段不能被序列化（static 修饰的静态的类变量，序列化针对的是对象的属性值）</p> <p>（2）<code>被 transient 修饰</code>的字段（在使用 Serializable 接口实现序列化的时候）不能被序列化</p></blockquote> <h3 id="_7-java-序列化总结"><a href="#_7-java-序列化总结" class="header-anchor">#</a> （7）Java 序列化总结</h3> <blockquote><p>总的来说，Java 提供的序列化机制使用比较麻烦，除了需要强制实现<code>java.io.Serializable</code>或<code>java.io.Externalizable</code>接口，还需要借助额外的 ObjectInputStream和 ObjectOutputStream 才能完成序列化和反序列化。</p> <p>其次，Java 序列化不支持跨语言，通用性差。</p> <p>由于种种原因，在需要序列化的时候通常我们都不会考虑使用 Java 提供的序列化机制，比如 Spring Cloud 使用的 Json 序列化、Dubbo 虽然兼容了 Java 序列化，但是默认使用的是 Hessian 序列化。</p></blockquote> <h2 id="json-序列化"><a href="#json-序列化" class="header-anchor">#</a> JSON 序列化</h2> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/java-core/dynamic-proxy.html" class="prev">
        Java 动态代理
      </a></span> <span class="next"><a href="/java-core/generic.html">
        Java 泛型
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.fa9b922e.js" defer></script><script src="/assets/js/2.25cc5d58.js" defer></script><script src="/assets/js/32.173e5f2d.js" defer></script>
  </body>
</html>
